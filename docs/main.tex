\documentclass{bmstu}

\usepackage{biblatex}
\addbibresource{biblio.bib}

\begin{document}

\setcounter{page}{3}

\chapter*{РЕФЕРАТ}

Объем РПЗ составляет 50 страниц, содержит 11 иллюстраций, 9 таблиц, 2 приложения и 19 использованных источников.

\textit{Ключевые слова}: прогнозирование цен, модель для прогнозирования цен, товары, магазины, история цен, приложение для работы с БД, СУБД, PostgreSQL, C\#, WPF.

В РПЗ были сформулированы цель и задачи работы, формализованы данные, описана ролевая модель, понятие СУБД и методы построения линии тренда. Также были разработаны БД, объекты БД, система безопасности БД, реализовано вышеперечисленное в ПО, решающее данную задачу, и был проведен эксперимент по оценке точности модели для предсказания цен на товары в магазинах.

\maketableofcontents

\chapter*{ВВЕДЕНИЕ}
\addcontentsline{toc}{chapter}{ВВЕДЕНИЕ}

Методы прогнозирования многообразны, как и объекты, прогнозированием которых занимается человек. Ему всегда было интересно узнать будущее -- свое, своих близких, государства, экономики, предугадать погоду, определить как изменятся в ближайшее время курсы валют и т. п.

Но прогнозировать ситуацию важно не только из-за того, что это интересно, но и потому, что от предвидения будущего зависят действия человека. Если прогнозируется скачок цен на какой-то товар, то можно заранее закупить его. Можно сказать, что жизнь современного человека невозможно себе представить без прогнозирования.

Прогноз -- это результат индуктивного вывода, когда по характеру ограниченного множества значений показателей или взаимосвязи факторов делается вывод о том, что и остальные, еще не наблюдаемые значения этих показателей или взаимосвязи будут обладать аналогичными свойствами \cite{hse-pred}.

В мировой экономической науке накоплен и апробирован значительный арсенал методов прогнозирования, который дает возможность решать комплекс задач по обоснованию решений в различных областях \cite{bel-prog}.

Задача прогнозирования цен на потребительские товары актуальна для различных типов пользователей: во-первых, это конечные покупатели, которые принимают решение о покупке того или иного товара; прогноз цены может повлиять не только на выбор момента покупки, но и на сам факт покупки товара как таковой; во-вторых, это владельцы магазинов (необязательно онлайн), которые планируют закупки и ассортимент товаров; в-третьих, маркетологи, формирующие аналитику изменения рынка тех или иных товаров \cite{met-pred-online}.

Цель работы -- реализовать базу данных, хранящую информацию о покупателях, магазинах, ассортименте товаров в магазинах и историях цен товаров в них, и программное обеспечение для работы с информацией из этой базы данных, а также прогнозирования цен на товары в магазинах посредством построения линии тренда на основе истории цен.

Таким образом, необходимо решить следующие задачи:

\begin{itemize}
	\item проанализировать предметную область решаемой задачи, выделить сущности, их атрибуты и связи, разработать модель предметной области;
	\item проанализировать варианты представления данных и выбрать из них подходящий для решения задачи;
	\item проанализировать существующие модели данных и системы управления базами данных и выбрать подходящую систему для хранения данных;
	\item проанализировать методы построения линии тренда и выбрать подходящий метод для прогнозирования цен;
	\item спроектировать базу данных, описать ее таблицы;
	\item реализовать интерфейс для работы с базой данных;
	\item реализовать возможность построения линии тренда для прогнозирования цен на товары в магазинах;
	\item исследовать, к чему стремится значение цены товара на следующий месяц при увеличении выборки истории цен.
\end{itemize}
	
\chapter{Аналитический раздел}

В данном разделе проведен анализ предметной области, описана ролевая модель, описаны существующие системы управления базами данных и методы построения линии тренда.

\section{Анализ предметной области}

База данных должна хранить информацию о:

\begin{itemize}
	\item магазинах;
	\item товарах;
	\item ассортименте товаров в магазинах;
	\item историю цен на товары в магазинах за последние полтора года;
	\item товарные чеки.
\end{itemize}

В таблице 1.1 представлены сущности предметной области и их атрибуты.

\begin{table}[H]
	\caption{Сущности и их атрибуты}
	\begin{center}
		\begin{tabular}{| l | p{11 cm} |} 
			\hline
			
			\textbf{Сущность} & \textbf{Атрибуты} \\  
			
			\hline
			
			Магазин & Название, описание магазина, ассортимент товаров \\
			
			\hline
			
			Товар & Название, тип товара, актуальная цена \\
			
			\hline
			
			Ассортимент товаров & Список товаров \\
			
			\hline
			
			История цен & Год, месяц, цена в этот период \\
			
			\hline
			
			Товарный чек & ФИО, дата покупки, информация о месте покупки(магазине), список купленных товаров, итоговая стоимость \\
			\hline
		\end{tabular}
	\end{center}
\end{table}

ER-диаграмма моделируемой области представлена на рисунке \ref{img:ER_rus.drawio}.

\includeimage
	{ER_rus.drawio}
	{f}
	{H}
	{\textwidth}
	{ER-диаграмма моделируемой области в нотации Чена}

\section{Описание ролевой модели}

Для управления системой введено три роли: пользователь, аналитик, администратор. На рисунке \ref{img:use_case.drawio} представлена Use-case-диаграмма.

\includeimage
	{use_case.drawio}
	{f}
	{H}
	{0.8\textwidth}
	{Use-case-диаграмма}


\begin{table}[H]
	\caption{Роли и описание их функционала}
	\begin{center}
		\begin{tabular}{| l | p{12 cm} |} 
			\hline
			
			\textbf{Роль} & \textbf{Функционал} \\  
			
			\hline
			
			Пользователь & Просмотр информации о магазинах, их ассортименте товаров и их актуальной стоимости \\
			
			\hline
			
			Аналитик & Просмотр информации о магазинах, их ассортименте товаров и их истории цен. Возможность прогнозирования цены на товар в магазине \\
			
			\hline
			
			Администратор & Просмотр, добавление и удаление информации о магазинах, их ассортименте товаров и их истории цен, товарных чеках. Возможность прогнозирования цены на товар в магазине \\
			
			\hline
		\end{tabular}
	\end{center}
\end{table}



Для доступа к ролям <<Аналитик>> и <<Администратор>> требуется авторизация (ввод пароля).

\section{Описание понятия СУБД}

Система управления базами данных (сокр. СУБД) -- Программная система, предназначенная для создания и хранения базы данных на основе некоторой модели данных, обеспечения логической и физической целостности содержащихся в ней данных, надежного и эффективного использования ресурсов (данных, пространства памяти и вычислительных ресурсов), предоставления к ней санкционированного доступа для приложений и конечных пользователей, а также для поддержки 
функций администратора базы данных \cite{kogal}.

""\newline
Функции СУБД:

\begin{itemize}
	\setlength\itemsep{0.01em}
	\item управление данными во внешней памяти;
	\item управление данными в оперативной памяти с использованием дискового кэша;
	\item журнализация изменений, резервное копирование и восстановление базы данных после сбоев;
	\item поддержка языков БД.
\end{itemize}

\subsection{Классификация СУБД по модели данных}

Модель данных --  система типов данных, типов связей между ними и допустимых видов ограничений целостности, которые могут быть для них определены. Здесь имеется в виду современное понимание типа данных как носителя свойств, определяющих и состояние экземпляров типа, и их поведение \cite{kogal}.

По этому признаку СУБД делят на:

\begin{itemize}
	\setlength\itemsep{0.01em}
	\item дореляционные;
	\item реляционные;
	\item постреляционные.
\end{itemize}


\subsection*{Дореляционные СУБД}

К ним относятся иерархические и сетевые СУБД.

""\newline
\noindent\textbf{Иерархические СУБД}

В иерархических СУБД используется представление базы данных в виде древовидной (иерархической) структуры, состоящей из объектов (данных) различных уровней.

Между объектами существуют связи, каждый объект может включать в себя несколько объектов более низкого уровня. Такие объекты находятся в отношении предка (объект более близкий к корню) к потомку (объект более низкого уровня), при этом возможна ситуация, когда объект-предок не имеет потомков или имеет их несколько, тогда как у объекта-потомка обязательно только один предок. Объекты, имеющие общего предка, называются близнецами \cite{scienceforum}.

В этой модели запрос, направленный вниз по иерархии, прост (например, какие заказы принадлежат этому покупателю); однако запрос, направленный вверх по иерархии, более сложен (например, какой покупатель поместил этот заказ). Также, трудно представить неиерархические данные при использовании этой модели \cite{scienceforum}.

Примеры: Caché, Google App Engine Datastore API.

""\newline
\noindent\textbf{Сетевые СУБД}

Сетевые СУБД подобны иерархическим, за исключением того, что в них имеются указатели в обоих направлениях, которые соединяют родственную информацию.

Несмотря на то, что эта модель решает некоторые проблемы, связанные с иерархической моделью, выполнение простых запросов остается достаточно сложным процессом.

Также, поскольку логика процедуры выборки данных зависит от физической организации этих данных, то эта модель не является полностью независимой от приложения. Другими словами, если необходимо изменить структуру данных, то нужно изменить и приложение \cite{scienceforum}.

Примеры: Caché.

""\newline
\noindent\textbf{Достоинства и недостатки}

Достоинствами дореляционной модели СУБД являются:

\begin{itemize}
	\item простые запросы, связанные с поиском потомков или предков (для сетевой модели).
\end{itemize}

Недостатками дореляционной модели СУБД являются:

\begin{itemize}
	\item выполнение остальных запросов является сложной задачей;
	\item не является полностью независимой от приложения.
\end{itemize}

\subsection*{Реляционные СУБД}

Реляционные СУБД ориентированы на организацию данных в виде двумерных таблиц. Каждая реляционная таблица представляет собой двумерный массив и обладает следующими свойствами:

\begin{enumerate}
	\item каждый элемент таблицы является одним элементом данных;
	\item каждый столбец обладает своим уникальным именем;
	\item одинаковые строки в таблице отсутствуют;
	\item все столбцы в таблице однородные, то есть все элементы в столбце имеют одинаковый тип;
	\item порядок следования строк и столбцов может быть произвольным.
\end{enumerate}

Практически все разработчики современных приложений, предусматривающих связь с системами баз данных, ориентируются на реляционные СУБД. По оценке Gartner в 2013 году рынок реляционных СУБД составлял 26 млрд долларов с годовым приростом около 9\%, а к 2018 году рынок реляционных СУБД достигнет 40 млрд долларов. В настоящее время абсолютными лидерами рынка СУБД являются компании Oracle, IBM и Microsoft, с общей совокупной долей рынка около 90\%, поставляя такие системы как Oracle Database, IBM DB2 и Microsoft SQL Server \cite{dbms}.

""\newline
\noindent\textbf{Достоинства и недостатки}

Достоинствами реляционной модели СУБД являются:

\begin{itemize}
	\item эта модель данных отображает информацию в наиболее простой для пользователя форме;
	\item основана на развитом математическом аппарате, который позволяет достаточно лаконично описать основные операции над данными;
	\item позволяет создавать языки манипулирования данными не процедурного типа;
	\item манипулирование данными на уровне выходной БД и возможность изменения.
\end{itemize}

Недостатками реляционной модели СУБД являются:

\begin{itemize}
	\item самый медленный доступ к данным.
\end{itemize}

\subsection*{Постреляционные СУБД}

Постреляционная модель является расширением реляционной модели. Она снимает ограничение неделимости данных, допуская многозначные поля, значения которых состоят из подзначений, и набор значений воспринимается как самостоятельная таблица, встроенная в главную таблицу \cite{post-rel}.

С ним относятся объектно-ориентированные и объектно-реляционные СУБД.

""\newline
\noindent\textbf{Объектно-ориентированные СУБД}

Объектно-ориентированные СУБД управляют базами данных, в которых данные моделируются в виде объектов, их атрибутов, методов и классов.

Этот вид СУБД позволяет работать с объектами баз данных так же, как с объектами в программировании в объектно-ориентированных языках программирования. ООСУБД расширяет языки программирования, прозрачно вводя долговременные данные, управление параллелизмом, восстановление данных, ассоциированные запросы и другие возможности \cite{dbms}.

Примеры: GemStone.

""\newline
\noindent\textbf{Объектно-реляционные СУБД}

Объектно-реляционные СУБД поддерживают некоторые технологии, реализующие объектно-ориентированный подход: объекты, классы и наследование реализованы в структуре баз данных и языке запросов.

Зачастую все те СУБД, которые называются реляционными, являются, фактически, объектно-реляционными \cite{dbms}.

В данной работе будет рассмотрен имено этот класс СУБД.

Примеры: PostgreSQL, DB2, Oracle Database, Microsoft SQL Server.

""\newline
\noindent\textbf{Достоинства и недостатки}

Достоинствами постреляционной модели СУБД являются:

\begin{itemize}
	\item все достоинства реляционной модели;
	\item возможность представления совокупности связанных реляционный таблиц в виде многомерной таблицы.
\end{itemize}

Недостатками реляционных СУБД являются:

\begin{itemize}
	\item сложность обеспечения целостности и непротиворечивости хранимых данных.
\end{itemize}


\section{Методы построения линии тренда}

Линия тренда -- прямая или кривая линия, аппроксимирующая (приближающая) исходные данные на основе уравнения регрессии или скользящего среднего \cite{lt-exel}. Аппроксимация определяется по ме­тоду наименьших квадратов \cite{mnk}. В зависимости от характера поведения исходных данных (убыва­ют, возрастают и т.д.) выбирается метод интерполяции, который сле­дует использовать для построения тренда.

\subsection{Виды линий трендов}

\subsubsection*{Линейная линия тренда}

Линейная линия тренда определяется функцией

\begin{equation}
	y = ax + b,
\end{equation}

где $a$ -- тангенс угла наклона прямой, $b$ -- смещение.

Прямая линия тренда (линейный тренд) наилучшим образом подходит для величин, изменяющихся с постоянной скоростью. Приме­няется в случаях, когда точки данных расположены близко к прямой \cite{lt-exel}.

\subsubsection*{Логарифмическая линия тренда}

Логарифмическа линия тренда определяется функцией

\begin{equation}
	y = a\ln x + b,
\end{equation}

где $a$ и $b$ -- константы.

Логарифмическая линия тренда соответствует ряду данных, значения которого вначале быстро растут или убывают, а затем постепенно стабилизируются. Может использоваться для положительных и отрицательных данных \cite{lt-exel}.

\subsubsection*{Полиномиальная линия тренда}

Полиномиальная линия тренда определяется функцией

\begin{equation}
	y = \sum_{i = 0}^{n} a_i x^i, n \leqslant 6,
\end{equation}

где $a_i$ -- коэффициенты полинома.

Полиномиальная линия тренда используется для описания попеременно возрастающих и убывающих данных. Степень полинома подбирают таким образом, чтобы она была на единицу больше количества экстремумов (максимумов и минимумов) кривой \cite{lt-exel}.

\subsubsection*{Экспоненциальная линия тренда}

Экспоненциальная линия тренда определяется функцией

\begin{equation}
	y = a e ^ {bx},
\end{equation}

где $a$ и $b$ -- константы.

Экспоненциальный тренд используется в случае непрерывного возрастания изменения данных. Построение указанного тренда не­возможно, если в множестве значений членов ряда присутствуют нулевые или отрицательные данные \cite{lt-exel}.

\subsubsection*{Степенная линия тренда}

Степенная линия тренда определяется функцией

\begin{equation}
	y = a x ^ b,
\end{equation}

где $a$ и $b$ -- константы.

Степенная линия тренда дает хорошие результаты для положительных данных с постоянным ускорением. Для рядов с нулевыми или отрицательными значениями построение указанной линии трен­да невозможно \cite{lt-exel}.

\subsubsection*{Линейная фильтрация}

Линейная фильтрация определяется формулой

\begin{equation}
	F_t = \frac{A_t + A_{t-1} + ... + A_{t-n+1}}{n}, (2 \leqslant t < n),
\end{equation}

где $n$ -- общее число членов ряда, $t$ -- параметр фильтра.

Тренд с линейной фильтрацией позволяет сгладить колебания данных, наглядно демонстрируя характер зависимостей \cite{lt-exel}. Для построения указанной линии тренда пользователь должен задать число $t$.

Линейная фильтрация использует метод скользящего среднего, при котором каждое значение функции заменяется средним арифметическим $A$ по $t$ соседним точкам, расположенным симметрично относительно данной. Линия тренда в этом случае уравнения не имеет \cite{lin-filt}, поэтому для прогноза изменения величины она не подходит.

\subsection{Анализ исходных данных для построения линии тренда}

Цена товара как величина положительная и имеет непостоянный рост: она может как расти, так и падать. Таким образом, для прогнозирования цен на товары подходит полиномиальная линия тренда.

\section*{Вывод к аналитическому разделу}
\addcontentsline{toc}{section}{Вывод к аналитическому разделу}

В данном разделе был проведен анализ предметной области, описана ролевая модель, описаны существующие системы управления базами данных и методы построения линии тренда.

\chapter{Конструкторский раздел}

В данном разделе представлена разработанная база данных для поставленной задачи, описаны объекты этой БД, компоненты ПО и система безопасности БД.

\section{Разработка базы данных}

В базе данных существует 6 таблиц, одна из которых является развязочной (Availability), и одно представление. Они представлены на диаграмме в виде сущностей. На рисунке \ref{img:ER-DB.drawio} представлена схема БД.

\includeimage
	{ER-DB.drawio}
	{f}
	{H}
	{0.8\textwidth}
	{Схема БД}

Таблица \textbf{Shop} хранит данные о магазинах и содержит следующие поля:
\begin{itemize}
	\item ID -- идентификатор магазина, целочисленный тип данных;
	\item Name -- название магазина, строковый тип данных;
	\item Description -- описание магазинаб строковый тип данных.
\end{itemize}


Таблица \textbf{Product} хранит данные о продуктах и содержит следующие поля:
\begin{itemize}
	\item ID -- идентификатор продукта, целочисленный тип данных;
	\item Name -- название продукта, строковый тип данных;
	\item ProductType -- тип продукта, строковый тип данных.
\end{itemize}


Таблица \textbf{Availability} хранит отношения наличия товара в каталоге магазина и содержит следующие поля:
\begin{itemize}
	\item ID -- идентификатор отношения, целочисленный тип данных;
	\item ShopID -- идентификатор магазина, целочисленный тип данных;
	\item ProductID -- идентификатор продукта, целочисленный тип данных.
\end{itemize}


Таблица \textbf{CostStory} хранит историю цен на товары в магазинах и содержит следующие поля:
\begin{itemize}
	\item ID -- идентификатор значения цены в конкретный год и месяц, целочисленный тип данных;
	\item Year -- год, целочисленный тип данных;
	\item Month -- месяц, целочисленный тип данных;
	\item Cost -- значение цены в конкретный год и месяц, целочисленный тип данных;
	\item AvailabilityID -- идентификатор отношения наличия товара в каталоге магазина, целочисленный тип данных.
\end{itemize}


Представление \textbf{Cost} хранит актуальное значение цены на товар в магазине и содержит следующие поля:
\begin{itemize}
	\item AvailabilityID -- идентификатор отношения наличия товара в каталоге магазина, целочисленный тип данных;
	\item Cost -- значение актуальной цены, целочисленный тип данных.
\end{itemize}


Таблица \textbf{SaleReceipt} хранит данные о товарных чеках и содержит следующие поля:
\begin{itemize}
	\setlength\itemsep{0.01em}
	\item ID -- идентификатор товарного чека, целочисленный тип данных;
	\item FIO -- ФИО покупателя, строковый тип данных;
	\item ShopID -- идентификатор магазина, в котором была совершена покупка, целочисленный тип данных;
	\item DateOfPurchase -- дата покупки, тип данных, представляющий дату.
\end{itemize}


Таблица \textbf{SaleReceiptPosition} хранит информацию о позиции в чеке и содержит следующие поля:
\begin{itemize}
	\setlength\itemsep{0.01em}
	\item ID -- идентификатор позиции чека, целочисленный тип данных;
	\item AvailabilityID -- идентификатор отношения наличия товара в каталоге магазина, целочисленный тип данных.
\end{itemize}


Таблицы \textbf{SaleReceiptPosition} и \textbf{CostStory} содержат поле идентификатора отношения наличия товара в каталоге магазина в целях борьбы с рассинхронизацией: товарный чек и история цен на товар в магазине не могут ссылаться на товары, которых нет в данном магазине.

Актуальная стоимость товара в магазине формируется как последнее по дате значение цены товара в истории цен.

\section{Разработка объектов базы данных}

Для разработанной базы данных были созданы:

\begin{itemize}
	\item хранимая функция get\_products\_by\_shopid;
	\item хранимая функция get\_coststory\_by\_shopid\_prodid;
	\item хранимая функция get\_salereceipts\_by\_shopid;
	\item хранимая функция get\_content\_from\_salereceipt;
	\item триггер remove\_too\_old\_coststory;
\end{itemize}

Функция \textbf{get\_products\_by\_shopid} возвращает список товаров, продающиеся в указанном магазине с идентификатором shop\_id, реализация которой представлена на листинге 2.1.

\begin{lstlisting}[language=sql, caption={Реализация хранимой функции get\_products\_by\_shopid}]
create or replace function get_products_by_shopid(shop_id integer)
returns table(ProdID integer, ProdName text, ProdType text, Cost float)
as $$
	select APC.ProductID, APC.Name, APC.ProductType, APC.Cost
	from (((select Availability.ID as AvailID, Availability.ShopID, Availability.ProductID from Availability where Availability.ShopID = shop_id) as A 
	join Products on A.ProductID = Products.ID) as AP join Costs on AP.AvailID = Costs.AvailabilityID) as APC;
$$ language sql;
\end{lstlisting}


Функция \textbf{get\_coststory\_by\_shopid\_prodid} предназначена для поиска полной истории цен на указанный товар в указанном магазине посредством их идентификаторов shop\_id и prod\_id соответственно, реализация которой представлена на листинге 2.2.

\begin{lstlisting}[language=sql, caption={Реализация хранимой функции get\_coststory\_by\_shopid\_prodid}]
create or replace function get_coststory_by_shopid_prodid(shop_id integer, prod_id integer)
returns table(Year integer, Month integer, Cost integer)
as $$
	select CostStory.Year, CostStory.Month, CostStory.Cost
	from CostStory
	where AvailabilityID = (select ID
	from Availability
	where ShopID = shop_id and ProductID = prod_id);
$$ language sql;
\end{lstlisting}


Функция \textbf{get\_salereceipts\_by\_shopid} возвращает список товарных чеков в указанном магазине посредством его идентификатора shop\_id, реализация которой представлена на листинге 2.3.

\begin{lstlisting}[language=sql, caption={Реализация хранимой функции get\_salereceipts\_by\_shopid}]
create or replace function get_salereceipts_by_shopid(shop_id integer)
returns table(SR_ID integer, FIO text, DateOfPurchase date, SummaryCost integer)
as $$
	select S.S_ID, max(FIO), max(DateOfPurchase), sum(Cost) as SummaryCost
	from ((select ID as S_ID, FIO, ShopID, DateOfPurchase from SaleReceipts where ShopID = shop_id) as SR join SaleReceiptPositions on SaleReceiptPositions.SaleReceiptID = SR.S_ID) as S join Costs on S.AvailabilityID = Costs.AvailabilityID
	group by S.S_ID;
$$ language sql;
\end{lstlisting}

Функция \textbf{get\_content\_from\_salereceipt} возвращает список товаров товарного чека с идентификатором sr\_id, реализация которой представлена на листинге 2.4.

\begin{lstlisting}[language=sql, caption={Реализация хранимой функции get\_content\_from\_salereceipt}]
create or replace function get_content_from_salereceipt(sr_id integer)
returns table(ProdID integer, Name text, ProductType text, Cost integer)
as $$
	select SAP.ProductID as ProdID, Name, ProductType, Cost::integer
	from ((SaleReceiptPositions join Availability on SaleReceiptPositions.AvailabilityID = Availability.ID) as SA join Products on Products.ID = SA.ProductID) as SAP join Costs on SAP.AvailabilityID = Costs.AvailabilityID
	where SaleReceiptID = sr_id;
$$ language sql;
\end{lstlisting} 

Триггер \textbf{remove\_too\_old\_coststory} поддерживает актуальность истории цен, т. е. при вставке нового значения истории цен для некоторого товара в магазине удаляет значения истории цен этого товара, которые являются старше относительно нового значения цены более чем на полтора года.

Сценарий создания всей базы данных (вместе с триггером) расположен в Приложении А.

\section{Разработка ПО}

Разрабатываемое ПО состоит из трех компонентов:

\begin{itemize}
	\item компонент доступа к данным;
	\item компонент бизнес-логики;
	\item компонент представления (пользовательский интерфейс).
\end{itemize}

Диаграмма взаимодействия компонентов представлена на рисунке \ref{img:Components.drawio}.

\includeimage
	{Components.drawio}
	{f}
	{H}
	{\textwidth}
	{Диаграмма взаимодействия компонентов ПО}

\section{Разработка системы безопасности БД}

В соответствии с описанной в Аналитическом разделе ролевой моделью, были созданы три пользователя с различными уровнями доступа к данным в БД.

\begin{itemize}
	\item <<Пользователь>>: имеет доступ только на чтение к таблицам магазинов Shops, товаров Products, стоимостей Costs и отношения наличия Availability.
	\item <<Аналитик>>: имеет доступ только на чтение к таблицам магазинов Shops, товаров Products, стоимостей Costs, истории цен на товары в магазинах CostStory и отношения наличия Availability.
	\item <<Администратор>>: имеет доступ ко всем таблицам БД с наличием прав на редактирование информации в них.
\end{itemize}

Как было сказано в Аналитическом разделе, для доступа к ролям <<Аналитик>> и <<Администратор>> требуется аутентификация (ввод пароля).

Для каждой роли пароли хранятся в базе данных ролей. Аутентификация происходит при подключении к БД, сравнивая пароль из БД и пароль, указанный в строке подключения к БД.

\section*{Вывод к конструкторскому разделу}
\addcontentsline{toc}{section}{Вывод к конструкторскому разделу}

В данном разделе была представлена разработанная база данных для поставленной задачи, описаны объекты этой БД, компоненты ПО и система безопасности БД.

\chapter{Технологический раздел}

В данном разделе представлены средства реализации, диаграммы классов компонентов и интерфейс программного обеспечения.

\section{Средства реализации}

\subsection*{Обзор и выбор СУБД}

Для выбора СУБД формулируются следующие критерии:

\begin{itemize}
	\item открытость;
	\item поддержка хранимых процедур и триггеров;
	\item кроссплатформенность;
	\item поддержка БД неограниченного размера;
\end{itemize}

Далее представлена таблица сравнения рассматриваемых СУБД по заданным критериям \cite{orc-db, mssql, pg, db2}.

\begin{table}[H]
	\caption{Сравнение СУБД по критериям}
	\begin{center}
		\begin{tabular}{| p{5 cm} | c | c | c | c |} 
			\hline
			
			\textbf{} & \textbf{Oracle DB} & \textbf{SQL Server} & \textbf{DB2} & \textbf{PostgreSQL} \\  
			
			\hline
			
			Открытость & - & - & - & + \\
			
			\hline
			
			Поддержка хранимых процедур и триггеров & + & + & - & + \\
			
			\hline
			
			Кроссплатформенность & + & - & + & + \\
			
			\hline
			
			Поддержка БД неограниченного размера & + & - & - & + \\
			
			\hline
		\end{tabular}
	\end{center}
\end{table}

Основываясь на таблице сравнения СУБД, для решения задачи была выбрана СУБД PostgreSQL.

\subsection*{Выбор и обснование средств реализации ПО}

В качестве языка программирования для реализации программного обеспечения для работы с БД был выбран C\# \cite{c-sharp}. Выбор этого языка обусловлен тем, что он обладает удобным синтаксисом, управляемым кодом и сборщиком мусора, благодаря этому не нужно заботится об утечках памяти, об указателях и о некоторых базовых структурах и алгоритмах -- все это уже реализовано. Это позволит ускорить разработку и отладку кода. Также данный язык предоставляет большую часть требуемого функционала для решения поставленной задачи, для недостающего функционала существует связанным с ним пакетным менеджер NuGet \cite{nuget}.

Для разработки пользовательского интерфейса программного обеспечения была выбрана платформа WPF \cite{wpf}. Данная платформа обладает декларативным определением элементов интерфейса с помощью языка разметки XAML \cite{xaml}, независимостью от разрешения экрана. Это значит, что приложение будет корректно масштабироваться под разные экраны с разным разрешением, а также данный интерфейс не будет жестко зависеть от логики программы.

В качестве среды разработки (IDE) была выбрана Visual Studio \cite{vs}, обладающая интеллектуальными подсказками, инструментами анализа, отладки и тестирования кода, поставляющаяся вместе с языком C\# и пакетным менеджером NuGet.

\section{Состав классов ПО}

Для каждого компонента, описанного в Конструкторском разделе, реализован набор классов, диаграммы которых представлены ниже.

На рисунке \ref{img:DA} представлена диаграмма классов компонента доступа к данным.

\includeimage
	{DA}
	{f}
	{H}
	{\textwidth}
	{Диаграмма классов компонента доступа к данным}
	
На рисунке \ref{img:BL} представлена диаграмма классов компонента бизнес-логики.

\includeimage
{BL}
{f}
{H}
{\textwidth}
{Диаграмма классов компонента бизнес-логики}

На рисунке \ref{img:V} представлена диаграмма классов компонента представления.

\includeimage
{V}
{f}
{H}
{\textwidth}
{Диаграмма классов компонента представления}	

\section{Интерфейс ПО}

Интерфейс включает в себя 4 секции для работы с БД.

\begin{enumerate}
	\item Работа с магазинами.
	\item Работа с товарами магазинов.
	\item Работа с товарными чеками магазинов.
	\item Работа с историей цен товаров в магазинах.
\end{enumerate}

""\newline\indent
На рисунках \ref{img:ui_user}-\ref{img:ui_admin} продемонстрирована работоспособность программы.


\includeimage
	{ui_user}
	{f}
	{H}
	{\textwidth}
	{Работа приложения в режиме пользователя}

На рисунке \ref{img:ui_user} представлено ПО при работе в режиме пользователя. В нем доступен просмотр списка магазинов с возможностью выбора магазина и просмотр данных о выбранном магазине в более удобном виде. Также в нем доступен просмотр списка товаров магазина с возможностью выбора товара и просмотр данных о выбранном товаре в более удобном виде.

\includeimage
	{ui_analyst}
	{f}
	{H}
	{\textwidth}
	{Работа приложения в режиме аналитика}
	
На рисунке \ref{img:ui_analyst} представлено ПО при работе в режиме аналитика. В нем доступны все фукнции в режиме пользователя, а также доступен просмотр истории цен на выбранный товар в выбранном магазине и отображение тренда цены.

\includeimage
	{ui_admin}
	{f}
	{H}
	{\textwidth}
	{Работа приложения в режиме администратора}

На рисунке \ref{img:ui_admin} представлено ПО при работе в режиме администратора. В нем доступны все фукнции в режиме аналитика, а также доступен просмотр товарных чеков выбранного магазина, их позиций, а также редактирование информации о магазинах, товарах, товарных чеках и истории цен с помощью соответствующих кнопок.

Для смены режима работы ПО нужно выбрать соответствующий режим в верхнем левом углу окна.

\section*{Вывод к технологическому разделу}
\addcontentsline{toc}{section}{Вывод к технологическому разделу}

В данном разделе были представлены средства реализации, диаграммы классов компонентов и интерфейс программного обеспечения.

\chapter{Экспериментальный раздел}

В данном разделе поставлен эксперимент по оценке отклонения значения стоимости товара на следующий месяц при неполной выборке истории цен от реального значения стоимости товара на следующий месяц.

\section{Постановка эксперимента}

\subsection{Цель эксперимента}

Целью эксперимента является проведение анализа отклонения значения стоимости товара на следующий месяц при неполной выборке истории цен от реального значения стоимости товара на следующий месяц.

\subsection{Описание эксперимента}

В данном эксперименте были выбраны три товара с указанными в таблицах 4.1-4.3 историями цен. Далее при расчете очередного значения стоимости товара на следующий месяц при неполной выборке истории цен объем выборки будет ограничиваться от 1 до $N = 18$, где $N$ -- объем полной выборки.
	
\begin{table}[H]
	\caption{История цен первого выбранного для эксперимента товара}
	\begin{center}
		\begin{tabular}{| c | c | c |} 
			\hline
			
			\textbf{Год} & \textbf{Месяц} & \textbf{Цена} \\  
			
			\hline
			
			2021 & 1 & 5155 \\
			
			\hline
			
			2021 & 2 & 5155 \\
			
			\hline
			
			2021 & 3 & 5155 \\
			
			\hline
			
			2021 & 4 & 5155 \\
			
			\hline
			
			2021 & 5 & 5155 \\
			
			\hline
			
			2021 & 6 & 5690 \\
			
			\hline
			
			2021 & 7 & 5815 \\
			
			\hline
			
			2021 & 8 & 5399 \\
			
			\hline
			
			2021 & 9 & 5226 \\
			
			\hline
			
			2021 & 10 & 5055 \\
			
			\hline
			
			2021 & 11 & 5384 \\
			
			\hline
			
			2021 & 12 & 5444 \\
			
			\hline
			
			2022 & 1 & 4940 \\
			
			\hline
			
			2022 & 2 & 4990 \\
			
			\hline
			
			2022 & 3 & 4990 \\
			
			\hline
			
			2022 & 4 & 4990 \\
			
			\hline
			
			2022 & 5 & 4990 \\
			
			\hline
			
			2022 & 6 & 4990 \\
			
			\hline
		\end{tabular}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{История цен второго выбранного для эксперимента товара}
	\begin{center}
		\begin{tabular}{| c | c | c |} 
			\hline
			
			\textbf{Год} & \textbf{Месяц} & \textbf{Цена} \\  
			
			\hline
			
			2021 & 1 & 18299 \\
			
			\hline
			
			2021 & 2 & 17599 \\
			
			\hline
			
			2021 & 3 & 16399 \\
			
			\hline
			
			2021 & 4 & 18090 \\
			
			\hline
			
			2021 & 5 & 18090 \\
			
			\hline
			
			2021 & 6 & 18090 \\
			
			\hline
			
			2021 & 7 & 19590 \\
			
			\hline
			
			2021 & 8 & 17999 \\
			
			\hline
			
			2021 & 9 & 18299 \\
			
			\hline
			
			2021 & 10 & 18699 \\
			
			\hline
			
			2021 & 11 & 19999 \\
			
			\hline
			
			2021 & 12 & 27790 \\
			
			\hline
			
			2022 & 1 & 31599 \\
			
			\hline
			
			2022 & 2 & 29799 \\
			
			\hline
			
			2022 & 3 & 34299 \\
			
			\hline
			
			2022 & 4 & 24990 \\
			
			\hline
			
			2022 & 5 & 29390 \\
			
			\hline
			
			2022 & 6 & 28399 \\
			
			\hline
		\end{tabular}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{История цен третьего выбранного для эксперимента товара}
	\begin{center}
		\begin{tabular}{| c | c | c |} 
			\hline
			
			\textbf{Год} & \textbf{Месяц} & \textbf{Цена} \\  
			
			\hline
			
			2021 & 1 & 69990 \\
			
			\hline
			
			2021 & 2 & 69990 \\
			
			\hline
			
			2021 & 3 & 69990 \\
			
			\hline
			
			2021 & 4 & 64990 \\
			
			\hline
			
			2021 & 5 & 52990 \\
			
			\hline
			
			2021 & 6 & 59990 \\
			
			\hline
			
			2021 & 7 & 64990 \\
			
			\hline
			
			2021 & 8 & 62990 \\
			
			\hline
			
			2021 & 9 & 67990 \\
			
			\hline
			
			2021 & 10 & 59990 \\
			
			\hline
			
			2021 & 11 & 69990 \\
			
			\hline
			
			2021 & 12 & 61990 \\
			
			\hline
			
			2022 & 1 & 61990 \\
			
			\hline
			
			2022 & 2 & 61990 \\
			
			\hline
			
			2022 & 3 & 61990 \\
			
			\hline
			
			2022 & 4 & 61990 \\
			
			\hline
			
			2022 & 5 & 61990 \\
			
			\hline
			
			2022 & 6 & 61990 \\
			
			\hline
		\end{tabular}
	\end{center}
\end{table}

\section{Результаты экперимента}

В результате эксперимента были получены значения, представленные в таблицах 4.4-4.6, где

\begin{itemize}
	\item n -- количество используемых значений для вычисления стоимости товара на следующий месяц;
	\item $\hat{y}$ -- аппроксимированное значение стоимости товара на следующий месяц;
	\item $y$ -- реальное значение стоимости товара на следующий месяц;
	\item $\frac{|\hat{y} - y|}{y}$ -- среднее значение относительной погрешности.
\end{itemize}

\begin{table}[H]
	\caption{Результаты эксперимента для первого товара}
	\begin{center}
		\begin{tabular}{| c | c | c | c |} 
			\hline
			
			\textbf{n = 1..N} & \textbf{$\hat{y}$} & \textbf{$y$} & \textbf{$\frac{|\hat{y} - y|}{y}$, \%} \\  
			
			\hline
			1 & 5155 & 5155 & 0\\
			\hline
			2 & 5155 & 5155 & 0\\
			\hline
			3 & 5155 & 5155 & 0\\
			\hline
			4 & 5155 & 5155 & 0\\
			\hline
			5 & 5155 & 5690 & 9,402\\
			\hline
			6 & 5435 & 5815 & 6,534\\
			\hline
			7 & 5652 & 5399 & 4,686\\
			\hline
			8 & 5642 & 5226 & 7,960\\
			\hline
			9 & 5406 & 5055 & 6,943\\
			\hline
			10 & 5167 & 5384 & 4,030\\
			\hline
			11 & 5162 & 5444 & 5,180\\
			\hline
			12 & 5318 & 4940 & 7,651\\
			\hline
			13 & 5107 & 4990 & 2,344\\
			\hline
			14 & 4945 & 4990 & 0,901\\
			\hline
			15 & 4945 & 4990 & 0,901\\
			\hline
			16 & 4960 & 4990 & 0,601\\
			\hline
			17 & 4970 & 4990 & 0,400\\
			\hline
		\end{tabular}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Результаты эксперимента для второго товара}
	\begin{center}
		\begin{tabular}{| c | c | c | c |} 
			\hline
			
			\textbf{n = 1..N} & \textbf{$\hat{y}$} & \textbf{$y$} & \textbf{$\frac{|\hat{y} - y|}{y}$, \%} \\  
			
			\hline
			1 & 18299 & 17599 & 3,977\\
			\hline
			2 & 17599 & 16399 & 7,317\\
			\hline
			3 & 16482 & 18090 & 8,888\\
			\hline
			4 & 17920 & 18090 & 0,939\\
			\hline
			5 & 18323 & 18090 & 1,288\\
			\hline
			6 & 18406 & 19590 & 6,043\\
			\hline
			7 & 19534 & 17999 & 8,528\\
			\hline
			8 & 18212 & 18299 & 0,475\\
			\hline
			9 & 18163 & 18699 & 2,866\\
			\hline
			10 & 18645 & 19999 & 6,770\\
			\hline
			11 & 20011 & 27790 & 27,992\\
			\hline
			12 & 27319 & 31599 & 13,544\\
			\hline
			13 & 32532 & 29799 & 9,171\\
			\hline
			14 & 30449 & 34299 & 11,224\\
			\hline
			15 & 33509 & 24990 & 34,089\\
			\hline
			16 & 25207 & 29390 & 14,232\\
			\hline
			17 & 28247 & 28399 & 0,5352\\
			\hline
		\end{tabular}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Результаты эксперимента для третьего товара}
	\begin{center}
		\begin{tabular}{| c | c | c | c |} 
			\hline
			
			\textbf{n = 1..N} & \textbf{$\hat{y}$} & \textbf{$y$} & \textbf{$\frac{|\hat{y} - y|}{y}$, \%} \\  
			
			\hline
			1 & 69990 & 69990 & 0\\
			\hline
			2 & 69990 & 69990 & 0\\
			\hline
			3 & 69990 & 64990 & 7,693\\
			\hline
			4 & 66490 & 52990 & 25,476\\
			\hline
			5 & 57790 & 59990 & 3,667\\
			\hline
			6 & 56311 & 64990 & 13,354\\
			\hline
			7 & 61870 & 62990 & 1,778\\
			\hline
			8 & 65414 & 67990 & 3,788\\
			\hline
			9 & 67284 & 59990 & 12,158\\
			\hline
			10 & 60009 & 69990 & 14,260\\
			\hline
			11 & 69993 & 61990 & 12,910\\
			\hline
			12 & 62889 & 61990 & 1,450\\
			\hline
			13 & 61792 & 61990 & 0,319\\
			\hline
			14 & 61888 & 61990 & 0,164\\
			\hline
			15 & 61964 & 61990 & 0,041\\
			\hline
			16 & 61851 & 61990 & 0,224\\
			\hline
			17 & 61625 & 61990 & 0,588\\
			\hline
		\end{tabular}
	\end{center}
\end{table}

На рисунке \ref{img:Errors} представлено графическое представление результатов эксперимента.
 
\includeimage
{Errors}
{f}
{H}
{\textwidth}
{Графическое представление результатов эксперимента}

\section*{Вывод к экспериментальному разделу}
\addcontentsline{toc}{section}{Вывод к экспериментальному разделу}

В данном разделе был поставлен эксперимент по оценке отклонения значения стоимости товара на следующий месяц при неполной выборке истории цен от реального значения стоимости товара на следующий месяц.

Из результатов эксперимента видно, что пока цена не подвержена каким-то аномально резким изменениям -- модель можно использовать. В таком случае ошибка не превышает 15\%, а иногда и 5\%, что говорит о удовлетворимом качестве модели прогнозирования. 

В противном случае, когда существуют аномальные изменения цены, ошибка превышает 15\%, что говорит о ненадёжности модели прогнозирования в таких условиях.

Из этого можно сделать вывод, что данная модель подходит для прогноза цен с минимальными колебаниями.


\chapter*{ЗАКЛЮЧЕНИЕ}
\addcontentsline{toc}{chapter}{ЗАКЛЮЧЕНИЕ}

В ходе выполнения курсового проекта был проведен анализ предметной области, описана ролевая модель, рассмотрены существующие СУБД и методы построения линии тренда. Была представлена разработанная база данных для поставленной задачи, описаны объекты этой БД и ее система безопасности. Также были представлены средства реализации и интерфейс программного обеспечения для выполнения данной задачи.

Созданная база данных позволяет хранить информацию о магазинах, товарах в них, товарных чеках и их содержимом, а также истории цен на товары в магазинах. Созданный программный продукт для работы с базой данных позволяет работать с информацией из нее: просматривать, добавлять, редактировать, удалять, анализировать.

Также был поставлен эксперимент, в ходе которого были выявлены условия использования реализованной модели для предсказания стоимости товара.

В качестве развития проекта можно предложить реализацию более устойчивых моделей для прогнозирования стоимостей товаров на следующий месяц для лучшей аппроксимации цены на товар в магазине. 

\makebibliography

\chapter*{ПРИЛОЖЕНИЕ А Сценарий создания БД}
\addcontentsline{toc}{chapter}{ПРИЛОЖЕНИЕ А Сценарий создания БД}

\includelisting
	{init_db}
	{Сценарий создания базы данных}

\chapter*{ПРИЛОЖЕНИЕ Б Презентация}
\addcontentsline{toc}{chapter}{ПРИЛОЖЕНИЕ Б Презентация}

\end{document}